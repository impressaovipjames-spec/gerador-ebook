/*!
 * turn.js 4.1.0
 * Turn.js is a 3D page turning utility for jQuery (v1.7.1+)
 * Requires: jQuery 1.7.1+
 * 
 * Copyright 2013 Emmanuel Garcia
 * Licensed MIT (http://creativecommons.org/licenses/MIT/)
 */

(function($) {
    
    function Turn(el, opts) {
        this.$el = $(el);
        this.options = $.extend({
            width: 400,
            height: 300,
            start: 1,
            page: 1,
            pages: 10,
            gradients: true,
            elevation: 0,
            gradients: true,
            disabled: false,
            spread: 'auto',
            gradients: true
        }, opts);
        
        this.init();
    }

    Turn.prototype.init = function() {
        var self = this;
        
        this.$el.addClass('turnjs-book').css({
            position: 'relative',
            overflow: 'hidden'
        });
        
        this.createPages();
        this.bindEvents();
        
        this.turnTo(this.options.page);
        
        return this;
    };

    Turn.prototype.createPages = function() {
        var self = this;
        
        for (var i = 1; i <= this.options.pages; i++) {
            var $page = $('<div class="turnjs-page" data-page="' + i + '">')
                .html('<div class="turnjs-page-content"><p>Page ' + i + '</p></div>')
                .css({
                    position: 'absolute',
                    width: this.options.width / 2,
                    height: this.options.height,
                    overflow: 'hidden',
                    background: '#fff',
                    boxShadow: '0 0 10px rgba(0,0,0,0.3)'
                });
            
            this.$el.append($page);
        }
    };

    Turn.prototype.bindEvents = function() {
        var self = this;
        
        this.$el.on('click', '.turnjs-page', function(e) {
            var page = $(this).data('page');
            if (page < self.options.pages) {
                self.next();
            }
        });
    };

    Turn.prototype.next = function() {
        if (this.currentPage < this.options.pages) {
            this.currentPage++;
            this.turnTo(this.currentPage);
        }
    };

    Turn.prototype.prev = function() {
        if (this.currentPage > 1) {
            this.currentPage--;
            this.turnTo(this.currentPage);
        }
    };

    Turn.prototype.turnTo = function(page) {
        this.currentPage = page;
        this.$el.find('.turnjs-page').css('display', 'none');
        
        if (page < this.options.pages) {
            this.$el.find('.turnjs-page[data-page="' + page + '"]').css('display', 'block');
            if (page + 1 <= this.options.pages) {
                this.$el.find('.turnjs-page[data-page="' + (page + 1) + '"]').css('display', 'block');
            }
        }
    };

    $.fn.turn = function(opts) {
        return this.each(function() {
            if (!$.data(this, 'turn')) {
                $.data(this, 'turn', new Turn(this, opts));
            }
        });
    };

})(jQuery);